<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Caesar Cipher & Sensitive Filter Tool</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        padding: 20px;
        max-width: 900px;
        margin: auto;
    }
    h2 {
        margin-bottom: 5px;
    }
    small {
        color: #555;
    }
    textarea {
        width: 100%;
        height: 140px;
        padding: 10px;
        font-size: 16px;
        margin-bottom: 10px;
        resize: vertical;
        box-sizing: border-box;
    }
    button {
        padding: 10px 20px;
        margin: 5px 5px 15px 0;
        font-size: 16px;
        cursor: pointer;
        border: none;
        border-radius: 5px;
        background: #ddd;
        transition: 0.2s;
    }
    button.active {
        background: #4287f5;
        color: white;
        font-weight: bold;
    }
    input[type=number] {
        padding: 5px;
        width: 80px;
        font-size: 16px;
        margin-bottom: 10px;
    }
    .note {
        font-size: 13px;
        color: #666;
        margin-bottom: 10px;
    }
</style>
</head>
<body>

<h2>üîê C√¥ng c·ª• m√£ h√≥a n√¢ng cao</h2>
<small>D√πng cho nhi·ªám v·ª• game, m√£ h√≥a, gi·∫£i m√£, ƒë·∫£o ch·ªØ, v√† l·ªçc t·ª´ nh·∫°y c·∫£m.</small>

<br><br>

<label for="inputText"><b>VƒÉn b·∫£n g·ªëc / c·∫ßn x·ª≠ l√Ω:</b></label>
<textarea id="inputText" oninput="updateOutput()"
          placeholder="Nh·∫≠p ƒëo·∫°n tho·∫°i, nhi·ªám v·ª• ho·∫∑c tin nh·∫Øn..."></textarea>

<label for="shift"><b>Shift (Caesar Cipher):</b></label><br>
<input type="number" id="shift" value="3" oninput="updateOutput()">

<div class="note">
    ‚Ä¢ M√£ h√≥a = Caesar + L·ªçc t·ª´ nh·∫°y c·∫£m ‚Üí m√£ s·ªë.<br>
    ‚Ä¢ Gi·∫£i m√£ = Caesar decode + d·ªãch m√£ s·ªë ‚Üí t·ª´ g·ªëc cho admin.<br>
    ‚Ä¢ ƒê·∫£o ch·ªØ = ƒë·∫£o th·ª© t·ª± k√Ω t·ª±, kh√¥ng d√πng Caesar v√† kh√¥ng l·ªçc nh·∫°y c·∫£m.
</div>

<button id="encodeBtn" class="active" onclick="setMode('encode')">M√£ h√≥a (Encode)</button>
<button id="decodeBtn" onclick="setMode('decode')">Gi·∫£i m√£ (Decode)</button>
<button id="reverseBtn" onclick="setMode('reverse')">ƒê·∫£o ch·ªØ (Reverse)</button>

<h3>K·∫øt qu·∫£:</h3>
<textarea id="outputText" readonly placeholder="K·∫øt qu·∫£ s·∫Ω xu·∫•t hi·ªán t·∫°i ƒë√¢y..."></textarea>

<script>
/* ======================= T·ª™ NH·∫†Y C·∫¢M ======================= */
const sensitiveMap = {
    "l·ªìn": "#9939#",
    "L·ªìn": "#9939#",
    "ƒë·ªãt": "#8003#",
    "ƒê·ªãt": "#L8003#",
};

const reverseSensitiveMap = {
    "#9939#": "l·ªìn",
    "#8003#": "ƒë·ªãt",
    "#L8003#": "ƒê·ªãt",
};

function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

function filterSensitive(text) {
    let output = text;
    for (const key in sensitiveMap) {
        const escaped = escapeRegExp(key);
        const regex = new RegExp(escaped, "g");
        output = output.replace(regex, sensitiveMap[key]);
    }
    return output;
}

function reverseSensitive(text) {
    let output = text;
    for (const code in reverseSensitiveMap) {
        const escaped = escapeRegExp(code);
        const regex = new RegExp(escaped, "g");
        output = output.replace(regex, reverseSensitiveMap[code]);
    }
    return output;
}

/* ======================= CAESAR CIPHER ======================= */
function caesar(str, shift) {
    shift = shift % 26;
    let output = "";

    for (let i = 0; i < str.length; i++) {
        let c = str[i];
        if (c.match(/[a-z]/i)) {
            let code = str.charCodeAt(i);
            if (code >= 65 && code <= 90) {
                c = String.fromCharCode(((code - 65 + shift + 26) % 26) + 65);
            } else if (code >= 97 && code <= 122) {
                c = String.fromCharCode(((code - 97 + shift + 26) % 26) + 97);
            }
        }
        output += c;
    }
    return output;
}

/* ======================= ƒê·∫¢O CH·ªÆ ======================= */
function reverseText(str) {
    return str.split("").reverse().join("");
}

/* ======================= CH·∫æ ƒê·ªò ======================= */
let mode = "encode";

function setMode(newMode) {
    mode = newMode;

    document.getElementById("encodeBtn").classList.toggle("active", mode === "encode");
    document.getElementById("decodeBtn").classList.toggle("active", mode === "decode");
    document.getElementById("reverseBtn").classList.toggle("active", mode === "reverse");

    updateOutput();
}

/* ======================= X·ª¨ L√ù ======================= */
function updateOutput() {
    let text = document.getElementById("inputText").value;
    let shift = parseInt(document.getElementById("shift").value);
    if (isNaN(shift)) shift = 0;

    let result = "";

    if (mode === "encode") {
        text = filterSensitive(text);
        result = caesar(text, shift);

    } else if (mode === "decode") {
        result = caesar(text, -shift);
        result = reverseSensitive(result);

    } else if (mode === "reverse") {
        result = reverseText(text);
    }

    document.getElementById("outputText").value = result;
}
</script>

</body>
</html>
