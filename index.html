<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Mini PvZ - Cแปng mแบทt trแปi vร ฤiแปm</title>
<!-- Link ฤแบฟn file CSS -->
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Mรn hรฌnh bแบฏt ฤแบงu -->
<div id="startScreen">
  <div id="startContent">
    <h1>๐ป MINI PLANTS VS ZOMBIES ๐ป</h1>
    <h2>Chรo mแปซng ฤแบฟn vแปi Mini PvZ!</h2>
    <p>๐ฏ <strong>ฤIแปU CHแปNH TRแบฌN ฤแบคU:</strong></p>
    <p>Trฦฐแปc khi bแบฏt ฤแบงu, bแบกn sแบฝ ฤฦฐแปฃc chแปn tแปซ 1 ฤแบฟn 15 loแบกi cรขy cho trแบญn ฤแบฅu.</p>
    <p>๐ง <strong>Xแบปng (cay9.png) cรณ sแบตn mแบทc ฤแปnh vร khรดng thแป bแป.</strong></p>
    <p>๐ฑ <strong>Chแปn cรขy cแบฉn thแบญn ฤแป tแบกo chiแบฟn thuแบญt riรชng!</strong></p>
    <button id="startBtn">๐ CHแปN CรY Vร BแบฎT ฤแบฆU</button>
  </div>
</div>

<!-- Mรn hรฌnh chแปn cรขy -->
<div id="plantSelectScreen" style="display: none;">
  <div id="plantSelectContent">
    <h2>๐ฑ CHแปN CรY CHO TRแบฌN ฤแบคU ๐ฑ</h2>
    <p>Chแปn tแปซ 1 ฤแบฟn 15 loแบกi cรขy (khรดng bao gแปm xแบปng - mแบทc ฤแปnh cรณ sแบตn)</p>
    <p id="selectedCount">ฤรฃ chแปn: 0/15</p>
    <div id="plantSelectionGrid">
      <!-- Danh sรกch cรขy sแบฝ ฤฦฐแปฃc tแบกo ฤแปng -->
    </div>
    <button id="confirmPlantsBtn" disabled>XรC NHแบฌN Vร BแบฎT ฤแบฆU</button>
  </div>
</div>

<!-- Mรn hรฌnh tแบกm dแปซng -->
<div id="pauseScreen" class="game-paused">
  โธ๏ธ GAME ฤANG TแบM DแปชNG
</div>

<div id="timer" style="position: absolute; top: 10px; right: 20px; font-size: 20px; color: white;">00:00</div>
<div id="panel">
  โ๏ธ Mแบทt trแปi: <span id="sun">100</span>
  <div class="shop-item" id="sunflower" onclick="selectPlant('sunflower')" title="Giรก: 50">
    <img src="cay1.png" alt="Hฦฐแปng dฦฐฦกng">
  </div>
  <div class="shop-item" id="bigsun" onclick="selectPlant('bigsun')" title="Giรก: 500">
    <img src="cay2.png" alt="Hฦฐแปng dฦฐฦกng to">
  </div>
  <div class="shop-item" id="pea" onclick="selectPlant('pea')" title="Giรก: 100">
    <img src="cay3.png" alt="Pea">
  </div>
  <div class="shop-item" id="peaice" onclick="selectPlant('peaice')" title="Giรก: 175">
    <img src="cay4.png" alt="Pea bฤng">
  </div>
  <div class="shop-item" id="pea2" onclick="selectPlant('pea2')" title="Giรก: 200">
    <img src="cay5.png" alt="Pea 2 ฤแบงu">
  </div>
  <div class="shop-item" id="wallnut" onclick="selectPlant('wallnut')" title="Giรก: 15">
    <img src="cay6.png" alt="รc chรณ">
  </div>
  <div class="shop-item" id="cherry" onclick="selectPlant('cherry')" title="Giรก: 250">
    <img src="cay7.png" alt="Cherry">
  </div>
  <div class="shop-item" id="azami" onclick="selectPlant('azami')" title="Giรก: 1000">
    <img src="cay8.png" alt="Azami">
  </div>
  <div class="shop-item" id="shovel" onclick="selectPlant('shovel')" title="Giรก: 0">
    <img src="cay9.png" alt="Xแบปng">
  </div>
  <div class="shop-item" id="cay10" onclick="selectPlant('cay10')" title="Giรก: 1500">
    <img src="cay10.png" alt="Cรขy siรชu bแบฏn">
  </div>
  <!-- Cรขy phแบฃn ฤแบกn -->
  <div class="shop-item" id="cay11" onclick="selectPlant('cay11')" title="Giรก: 5000 - Phแบฃn ฤแบกn">
    <img src="cay11.png" alt="Cรขy phแบฃn ฤแบกn">
  </div>
  <!-- Cรขy tฤng cฦฐแปng ฤแบกn -->
  <div class="shop-item" id="cay12" onclick="selectPlant('cay12')" title="Giรก: 5000 - Tฤng cฦฐแปng ฤแบกn">
    <img src="cay12.png" alt="Cรขy tฤng cฦฐแปng ฤแบกn">
  </div>
  <!-- Cรขy mแปi -->
  <div class="shop-item" id="cay13" onclick="selectPlant('cay13')" title="Giรก: 10000 - Hแบฏc diแปp thแบกch">
    <img src="cay13.png" alt="Hแบฏc diแปp thแบกch">
  </div>
  <div class="shop-item" id="cay14" onclick="selectPlant('cay14')" title="Giรก: 25000 - รc chรณ siรชu khuyแปn (Giแบฃm 50% sรกt thฦฐฦกng, Kแปน nฤng 3x3)">
    <img src="cay14.png" alt="รc chรณ siรชu khuyแปn">
  </div>
  <div class="shop-item" id="cay15" onclick="selectPlant('cay15')" title="Giรก: 20000 - ฤแบกi bรกc ฤแปa ngแปฅc">
    <img src="cay15.png" alt="ฤแบกi bรกc ฤแปa ngแปฅc">
  </div>
  <!-- Cรขy mรฌn hแบฏc diแปp thแบกch -->
  <div class="shop-item" id="cay16" onclick="selectPlant('cay16')" title="Giรก: 1500 - Mรฌn hแบฏc diแปp thแบกch (3000 mรกu, hแปi 1 HP/s cho toรn bแป cรขy, khi bแป tแบฅn cรดng gรขy 30 sรกt thฦฐฦกng toรn sรขn)">
    <img src="cay16.png" alt="Mรฌn hแบฏc diแปp thแบกch">
  </div>
  <!-- Cรขy tแปi biแบฟn dแป -->
  <div class="shop-item" id="cay17" onclick="selectPlant('cay17')" title="Giรก: 2000 - Tแปi biแบฟn dแป (Bแบฏn ฤแบกn tแบงm 2 รด, 10 sรกt thฦฐฦกng + bแบญt lรนi 0.5 รด, khi bแป tแบฅn cรดng ฤแบฉy zombie sang hรng khรกc + lรm chแบญm 80% 5s)">
    <img src="cay17.png" alt="Tแปi biแบฟn dแป">
  </div>
  <!-- Cรขy tแปi biแบฟn dแป phiรชn bแบฃn nรฉm ฤแบกn -->
  <div class="shop-item" id="cay18" onclick="selectPlant('cay18')" title="Giรก: 50000 - Tแปi biแบฟn dแป nรฉm ฤแบกn (30 mรกu, nรฉm ฤแบกn nแบฃy, 30 sรกt thฦฐฦกng + 3 ฤแบกn nแบฃy 20 sรกt thฦฐฦกng, giแบฃm tแปc 30% vฤฉnh viแปn, khi bแป tแบฅn cรดng ฤแบฉy zombie + giแบฃm 99% tแปc 10s)">
    <img src="cay18.png" alt="Tแปi biแบฟn dแป nรฉm ฤแบกn">
  </div>
  <!-- Cรขy 19 - Quแบฃ รณc chรณ ฤแปa ngแปฅc sinh ฤรดi -->
  <div class="shop-item disabled" id="cay19" onclick="selectPlant('cay19')" title="ฤรฃ tiรชu diแปt Sแปฉ giแบฃ khe nแปฉt: 0/1 - Giรก: 0 (Mแป khรณa khi tiรชu diแปt 1 Sแปฉ giแบฃ khe nแปฉt)">
    <img src="cay19.png" alt="รc chรณ ฤแปa ngแปฅc sinh ฤรดi">
  </div>
  <div class="shop-item" id="noSelect" onclick="deselectPlant()" title="Khรดng chแปn cรขy">
    <img src="no_select_icon.png" alt="Khรดng chแปn cรขy">
  </div>
  <button id="pauseBtn" onclick="togglePause()">โธ๏ธ Tแบกm dแปซng</button>
  <span id="selected"></span>
</div>

<div id="game">
  <div id="scoreBoard">๐ ฤiแปm: <span id="score">0</span></div>
</div>

<audio id="shootSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<audio id="boomSound" src="https://actions.google.com/sounds/v1/explosions/explosion.ogg"></audio>
<audio id="dieSound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>
<audio id="garlicSound" src="https://actions.google.com/sounds/v1/cartoon/slide_whistle.ogg"></audio>
<audio id="throwSound" src="https://actions.google.com/sounds/v1/cartoon/boing.ogg"></audio>
<audio id="bounceSound" src="https://actions.google.com/sounds/v1/cartoon/cartoon_bounce.ogg"></audio>
<audio id="hellfireSound" src="https://actions.google.com/sounds/v1/fire/fire_large.ogg"></audio>

<!-- CแบคU HรNH GAME -->
<script>
// Biแบฟn toรn cแปฅc ฤแป cรกc file JS cรณ thแป truy cแบญp
let selectedPlants = new Set();

// =============== CแบคU HรNH Dแป CHแปNH SแปฌA ===============
const PLANT_CONFIG = {
  defaultSize: {
    width: 60,
    height: 60
  },
  
  plants: {
    sunflower: {
      name: "Hฦฐแปng dฦฐฦกng",
      cost: 50,
      hp: 20,
      image: "cay1.png",
      width: 60,
      height: 60,
      action: {
        type: "sunProducer",
        interval: 5000,
        amount: 25
      }
    },
    bigsun: {
      name: "Hฦฐแปng dฦฐฦกng to",
      cost: 500,
      hp: 25,
      image: "cay2.png",
      width: 65,
      height: 65,
      action: {
        type: "sunProducer",
        interval: 1000,
        amount: 10
      }
    },
    pea: {
      name: "Pea",
      cost: 100,
      hp: 15,
      image: "cay3.png",
      width: 60,
      height: 60,
      action: {
        type: "shooter",
        interval: 1500,
        bullet: { color: "yellow", power: 2, count: 1 }
      }
    },
    peaice: {
      name: "Pea bฤng",
      cost: 175,
      hp: 15,
      image: "cay4.png",
      width: 60,
      height: 60,
      action: {
        type: "shooter",
        interval: 2000,
        bullet: { color: "blue", power: 1, count: 1, freeze: true }
      }
    },
    pea2: {
      name: "Pea 2 ฤแบงu",
      cost: 200,
      hp: 15,
      image: "cay5.png",
      width: 65,
      height: 60,
      action: {
        type: "shooter",
        interval: 2000,
        bullet: { color: "green", power: 2, count: 2 }
      }
    },
    wallnut: {
      name: "รc chรณ",
      cost: 15,
      hp: 500,
      image: "cay6.png",
      width: 70,
      height: 70,
      action: { type: "none" }
    },
    cherry: {
      name: "Cherry",
      cost: 250,
      hp: 10,
      image: "cay7.png",
      width: 60,
      height: 60,
      action: {
        type: "exploder",
        delay: 1500,
        damage: 1000,
        range: 1.5
      }
    },
    azami: {
      name: "Azami",
      cost: 1000,
      hp: 50,
      image: "cay8.png",
      width: 60,
      height: 60,
      action: {
        type: "shooter",
        interval: 700,
        bullet: { color: "az", power: 10, count: 1, knock: true },
        cost: 25
      },
      limitPerRow: 1
    },
    cay10: {
      name: "Cรขy siรชu bแบฏn",
      cost: 1500,
      hp: 90,
      image: "cay10.png",
      width: 90,
      height: 70,
      action: {
        type: "shooter",
        interval: 4000,
        bullet: { color: "red", power: 30, count: 1 }
      },
      limitPerRow: 1
    },
    shovel: {
      name: "Xแบปng",
      cost: 0,
      hp: 0,
      image: "cay9.png",
      width: 50,
      height: 50,
      action: { type: "tool" }
    },
    cay11: {
      name: "Cรขy phแบฃn ฤแบกn",
      cost: 5000,
      hp: 10,
      maxHp: 10,
      image: "cay11.png",
      width: 60,
      height: 60,
      action: { type: "reflector" }
    },
    cay12: {
      name: "Cรขy tฤng cฦฐแปng ฤแบกn",
      cost: 5000,
      hp: 50,
      image: "cay12.png",
      width: 60,
      height: 60,
      action: { type: "enhancer" }
    },
    cay13: {
      name: "Hแบฏc diแปp thแบกch",
      cost: 10000,
      hp: 1700,
      maxHp: 1700,
      image: "cay13.png",
      width: 70,
      height: 70,
      action: { 
        type: "blocker",
        healPerSecond: 30
      }
    },
    cay14: {
      name: "รc chรณ siรชu khuyแปn",
      cost: 25000,
      hp: 8000,
      maxHp: 8000,
      image: "cay14.png",
      width: 80,
      height: 80,
      action: {
        type: "areaHealer",
        interval: 3000,
        damage: 100,
        range: 1,
        healMultiplier: 1.0,
        damageReduction: 0.5
      }
    },
    cay15: {
      name: "ฤแบกi bรกc ฤแปa ngแปฅc",
      cost: 20000,
      hp: 600,
      image: "cay15.png",
      width: 70,
      height: 70,
      action: {
        type: "hellCannon",
        interval: 800,
        bullet: { color: "hell-cannon", power: 10, count: 1, knock: true }
      }
    },
    cay16: {
      name: "Mรฌn hแบฏc diแปp thแบกch",
      cost: 1500,
      hp: 3000,
      maxHp: 3000,
      image: "cay16.png",
      width: 60,
      height: 60,
      action: {
        type: "mine",
        healPerSecond: 1,
        explosionDamage: 30,
        explosionOnHit: true
      }
    },
    cay17: {
      name: "Tแปi biแบฟn dแป",
      cost: 2000,
      hp: 80,
      image: "cay17.png",
      width: 60,
      height: 60,
      action: {
        type: "garlic",
        interval: 2000,
        bullet: { 
          color: "garlic-bullet", 
          power: 10, 
          count: 1, 
          knock: true,
          knockDistance: 0.5,
          range: 2
        },
        defenseEffect: {
          teleportDistance: 1,
          slowAmount: 0.8,
          slowDuration: 5000
        }
      }
    },
    cay18: {
      name: "Tแปi biแบฟn dแป nรฉm ฤแบกn",
      cost: 50000,
      hp: 80,
      maxHp: 80,
      image: "cay18.png",
      width: 65,
      height: 65,
      action: {
        type: "thrower",
        interval: 3000,
        bullet: {
          image: "dancay18.png",
          mainDamage: 80,
          bounceDamage: 20,
          bounceCount: 3,
          slowAmount: 0.3,
          maxSlow: 1.0,
          throwHeight: 60
        },
        defenseEffect: {
          teleportDistance: 1,
          extremeSlowAmount: 0.99,
          extremeSlowDuration: 10000
        }
      }
    },
    cay19: {
      name: "รc chรณ ฤแปa ngแปฅc sinh ฤรดi",
      cost: 0,
      baseCost: 0,
      hp: 30000,
      maxHp: 30000,
      image: "cay19.png",
      width: 85,
      height: 85,
      action: {
        type: "hellfireWalnut",
        sunPerMana: 300,
        manaPerSecond: 25,
        damageReduction: 0.8,
        healOnHit: 100,
        bulletEnhanceDamage: 500,
        blocksZombies: true
      }
    }
  }
};

// =============== CแบคU HรNH THรY MA Dแป CHแปNH SแปฌA ===============
const ZOMBIE_CONFIG = {
  attackInterval: 1000,
  
  zombies: {
    normal: {
      name: "Thรขy ma thฦฐแปng",
      baseHp: 44,
      speed: 0.01,
      attackDamage: 2,
      sunReward: 25,
      scoreReward: 1
    },
    red: {
      name: "Thรขy ma ฤแป",
      baseHp: 62,
      speed: 0.007,
      attackDamage: 3,
      hpBonusPerKill: 5,
      sunReward: 25,
      scoreReward: 1
    },
    big: {
      name: "Thรขy ma to",
      baseHp: 90,
      speed: 0.0025,
      attackDamage: 5,
      sunReward: 25,
      scoreReward: 1
    },
    smart: {
      name: "Thรขy ma thรดng minh",
      baseHp: 90,
      speed: 0.013,
      attackDamage: 3,
      sunReward: 25,
      scoreReward: 1
    },
    purple: {
      name: "Boss",
      baseHp: 500,
      speed: 0.001,
      attackDamage: 10,
      sunReward: 25,
      scoreReward: 1
    },
    thayma2: {
      name: "Thรขy ma 2 - ฤi xuyรชn qua cรขy",
      baseHp: 100,
      speed: 0.015,
      attackDamage: 0,
      canAttack: false,
      passThroughPlants: true,
      sunReward: 50,
      scoreReward: 3
    },
    thayma3: {
      name: "Thรขy ma 3 - Chแบทn ฤฦฐแปng",
      baseHp: 3000,
      speed: 0.02,
      attackDamage: 0,
      canAttack: false,
      stopsAtPlant: true,
      sunReward: 75,
      scoreReward: 5
    },
    thayma4: {
      name: "Thรขy ma 4 - Bom nแป",
      baseHp: 500,
      speed: 0.0015,
      attackDamage: 999,
      explosionOnDeath: true,
      explosionRange: 1.5,
      sunReward: 100,
      scoreReward: 10
    },
    thayma5: {
      name: "Thรขy ma 5 - Chiแบฟn binh bแบฅt khแบฃ chiแบฟn bแบกi",
      baseHp: 8000,
      speed: 0.018,
      attackDamage: 5,
      immuneToControl: true,
      immuneToKnockback: true,
      canAttack: true,
      sunReward: 150,
      scoreReward: 15
    },
    thayma6: {
      name: "Thรขy ma 6 - Quรกi vแบญt tแปi thฦฐแปฃng",
      baseHp: 5000000,
      speed: 0.01,
      attackDamage: 0,
      canAttack: false,
      immuneToControl: true,
      immuneToKnockback: true,
      immuneToExplosion: true,
      stopsAtDistance: 2,
      rangedAttack: true,
      rangedDamage: 200,
      rangedInterval: 5000,
      rangedTarget: "first",
      sunReward: 1000,
      scoreReward: 100,
      winOnKill: true
    },
    // THรY MA 7 - Sแปจ GIแบข KHE NแปจT
    thayma7: {
      name: "Sแปฉ giแบฃ khe nแปฉt",
      baseHp: 60000,
      speed: 0.015,
      attackDamage: 999,
      attackInterval: 3000,
      canAttack: true,
      knockbackOnHit: true,
      knockbackDistance: 1,
      sunReward: 500,
      scoreReward: 50
    },
    // THรY MA 8 - BARON NASHOR
    thayma8: {
      name: "Baron Nashor",
      baseHp: 100000,
      speed: 0.02,
      attackDamage: 0,
      canAttack: false,
      stopsAtDistance: 2,
      immuneToControl: true,
      immuneToKnockback: true,
      immuneToExplosion: true,
      buffsThayma7: true,
      buffSpeedAmount: 1.0,
      buffAttackSpeedAmount: 1.0,
      spawnsThayma7OnDeath: true,
      spawnedThayma7Hp: 300000,
      spawnOnAppearance: true,
      sunReward: 1000,
      scoreReward: 200
    }
  },
  
  timeUpdates: {
    interval: 30,
    hpIncrease: 10,
    speedIncrease: 0.01
  }
};

// Khแปi tแบกo nรบt bแบฏt ฤแบงu
document.getElementById("startBtn").onclick = function() {
  // Kiแปm tra xem cรณ lแปฑa chแปn ฤรฃ lฦฐu khรดng
  const hasSavedSelection = loadPlantSelection();
  
  if (hasSavedSelection && selectedPlants.size > 0) {
    // Hแปi ngฦฐแปi chฦกi cรณ muแปn dรนng lแปฑa chแปn cลฉ khรดng
    const plantCount = selectedPlants.size;
    if (confirm(`Bแบกn cรณ muแปn sแปญ dแปฅng lแปฑa chแปn cรขy tแปซ lแบงn chฦกi trฦฐแปc? (Cรณ ${plantCount} cรขy ฤรฃ chแปn)\n\nChแปn "OK" ฤแป sแปญ dแปฅng lแปฑa chแปn cลฉ.\nChแปn "Cancel" ฤแป chแปn lแบกi cรขy.`)) {
      document.getElementById("startScreen").style.display = "none";
      updateShopWithSelectedPlants();
      // Thรชm nรบt chแปn lแบกi cรขy
      addResetButtonToGame();
      // Khแปi tแบกo game
      initGameAfterSelection();
      return;
    }
  }
  
  // Hiแปn thแป mรn hรฌnh chแปn cรขy
  showPlantSelectionScreen();
};
</script>

<!-- File JavaScript chรญnh cแปงa game -->
<script src="plant-selection.js"></script>
<script src="game-main.js"></script>

</body>
</html>